用总方案减去后手必胜的方案，两者都用下面的方式dp，只不过后手必胜的方案要求每一位恰好填偶数个$1$。

（注：总方案数也可以直接容斥计算。）

设$dp[i][j][s]$为当前从高到低考虑到第$i$位，目前需要低位向当前位进$j$次，当前卡上限的集合是$s$。

注意到$j$的范围只能是$0\thicksim m-1$，不然无论如何不够进。

转移时，无需枚举下一位填什么(这样复杂度就到$4^m$了)，而是直接枚举$s$的子集表示解除卡上限，对于不卡上限的位来说可以直接乘一个系数转移。

复杂度是$O(3^m\times m^2 \times \log n)$的，由于状态很不满可以跑得很快。

